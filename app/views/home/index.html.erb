<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<style>
    .grid-container {
        display: grid;
        grid-template-columns: repeat(3, 270px); 
        grid-gap: 27px; 
    }

    .grid-item {
        width: 270px;
        height: 190px;
        background-color: #ccc;
        border: 1px solid #000;
    }

    .task-content {
        height: 58px;
        width: 268px;
        background-color: white;
        margin-top: 130px;
    }

    .vertical-line {
        border-right: 3px solid #b8b9b9;
        height: 650px;
        position: absolute;
        top: 100px;
        right: 480px;
    }

    .grid-container-wrapper {
        display: flex;
        flex-direction: column;
        align-items: flex-start; 
    }

    .colorP0 {
        background-color: #ff5757; 
    }

    .colorP1 {
        background-color: #ffd357 
    }

    .colorP2 {
        background-color: #95ff57; 
    }

    .colorC0 {
        background-color: #97fcff
    }

    .colorC1 {
        background-color: #6f69fe; 
    }

    .colorC2 {
        background-color: #b969fe"; 
    }
</style>

<% if current_user.student? %>
    <div style= "margin-top: 20px; margin-left: 20px;"> 
        <h1 style= "font-weight: bold"> Home </h1>
        <br>
        <meta name="csrf-token" content="<%= form_authenticity_token %>" />
        <h4> Tareas pendientes <h4>
        <div class="grid-container-wrapper">
            <div class="grid-container" id="gridContainer">
            <% @pending_tasks.each_with_index do |task, index| %>
                <% color_class = "colorP#{index}"%> 
                <div class="grid-item <%= color_class %>" data-task-id="<%= task.id %>" data-task-complexity="<%= task.complexity %>">
                        <div class="task-content">
                            <div style= "margin-left: 20px;">
                                <h5 style= "font-weight: bold"> Tarea <%= current_user.task_number %> </h5> 
                                <p style= "font-size: 14px;"> <%= task.complexity %> </p>
                            </div>
                        </div>
                    </div>
                <% end %>
            </div>
        <br>
        <h4> Tareas pasadas del módulo <h4>
        <div class="grid-container" id="gridContainer2">
        <% @completed_or_skipped_tasks.each_with_index do |task, index| %>
            <% color_class = "colorC#{index}"%> 
            <div class="grid-item <%= color_class %>" data-task-id="<%= task.id %>" data-task-complexity="<%= task.complexity %>">
                <div class="task-content">
                    <div style= "margin-left: 20px;">
                        <h5 style= "font-weight: bold"> Tarea <%= current_user.task_number %> </h5> 
                        <p style= "font-size: 14px;"> <%= task.complexity %> </p>
                    </div>
                </div>
            </div>
        <% end %>
        <div class="vertical-line"></div>
        <div style= "width: 250px; height: 300px; background-color: #d8d8d8; position: absolute; top: 120px; right: 110px; border: 2px solid #b8b9b9;"> 
            <div style= "width: 246px; height: 100px; background-color: white; margin-top: 196px; border-top: 2px solid #b8b9b9;">
                <h3 style= "font-weight: bold; font-size: 17px; margin-top: 7px; margin-left: 65px;"><%= current_user.name + " " + current_user.last_name%></h3>
                <p style= "font-size: 12px; margin-left: 37px;">Email: <%= current_user.email%></p>
            </div>
            <div>
                <h2 style= "margin-top: 10px; margin-left: 50px; font-weight: bold;"> Nivel del estudiante </h2>
                <div id="divEncimaDelChart" style="position: absolute; top: 460px; left: 64px; width: 117px; height: 117px; border-radius: 100px; background-color: rgba(255, 255, 255); z-index: 2; display: flex; align-items: center; justify-content: center;">
                   <h1> <%= current_user.user_level %> </h1>
                </div>
                <canvas id="nivelEstudiante" style= "width: 100px; height: 100px;"></canvas>
            </div>
        </div>
    </div>
    </div>
<% else %>
    <div>
    </div>
<% end %>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


<script>
  document.addEventListener('DOMContentLoaded', function() {
    var level = <%= current_user.user_level %>;

    var ctx = document.getElementById('nivelEstudiante').getContext('2d');

    var data = {
      datasets: [{
        data: [level, 10 - level],
        backgroundColor: [
          '#439cff', // Color para el nivel del estudiante
          '#dbebff'  // Color para el espacio restante
        ],
        hoverBackgroundColor: [
          '#439cff',
          '#dbebff'
        ]
      }]
    };

    var options = {
      cutoutPercentage: 80, // Controla qué tan grande es el agujero del donut
      rotation: -Math.PI,  // Controla la rotación del gráfico (en este caso, gira 180 grados para que empiece en la parte superior)
      circumference: 115*Math.PI, // Controla cuánto de la circunferencia se usa para el gráfico
    };

    var myDoughnutChart = new Chart(ctx, {
      type: 'doughnut',
      data: data,
      options: options
    });
    
  });
</script>